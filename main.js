/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var w=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var A=(c,e)=>{for(var n in e)w(c,n,{get:e[n],enumerable:!0})},P=(c,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let m of D(e))!$.call(c,m)&&m!==n&&w(c,m,{get:()=>e[m],enumerable:!(i=x(e,m))||i.enumerable});return c};var M=c=>P(w({},"__esModule",{value:!0}),c);var B={};A(B,{default:()=>S});module.exports=M(B);var k=require("obsidian");var v={inspectedItemTypes:[],nonInspectedItemTypes:[],collections:[]},f=10,u=0,h=10;var o=require("obsidian");function I(){return typeof crypto!="undefined"&&"randomUUID"in crypto?crypto.randomUUID():`id-${Date.now()}-${Math.random().toString(16).slice(2)}`}function R(c){let e=c.inspectedItemTypes.map(i=>({id:i.id,name:i.name,kind:i.kind})),n=c.nonInspectedItemTypes.map(i=>({id:i.id,name:i.name,kind:i.kind}));return[...e,...n]}function E(c,e){var l,g,T;let n=[],i=c.items.filter(r=>e.get(r.typeId)==="point"),m=new Set(i.map(r=>r.id)),a=new Set,t=new Map;for(let r of c.items)if(e.get(r.typeId)==="linear"){if(!r.startStationItemId||!r.endStationItemId){n.push(`Collection "${c.name}": linear item "${r.name}" must have both a start and end station item.`);continue}if(!m.has(r.startStationItemId)||!m.has(r.endStationItemId)){n.push(`Collection "${c.name}": linear item "${r.name}" must reference point items for start and end.`);continue}a.add(r.startStationItemId),a.add(r.endStationItemId),t.has(r.startStationItemId)||t.set(r.startStationItemId,new Set),t.has(r.endStationItemId)||t.set(r.endStationItemId,new Set),(l=t.get(r.startStationItemId))==null||l.add(r.endStationItemId),(g=t.get(r.endStationItemId))==null||g.add(r.startStationItemId)}if(a.size<=1)return n;let[s]=a;if(!s)return n;let d=new Set,p=[s];for(;p.length>0;){let r=p.shift();if(!r||d.has(r))continue;d.add(r);let b=(T=t.get(r))!=null?T:new Set;for(let N of b)d.has(N)||p.push(N)}return d.size!==a.size&&n.push(`Collection "${c.name}": the linear network is not fully connected. Ensure each linear item connects through stationed point items.`),n}function C(c){let e=[],n=new Set;for(let a of c.inspectedItemTypes){let t=a.name.trim();t||e.push("Inspected item types must have a name."),n.has(t)&&e.push(`Inspected item type name "${t}" is duplicated.`),n.add(t);for(let s of a.components)s.name.trim()||e.push(`Component names for "${a.name}" cannot be empty.`),(s.ratingScale.min<u||s.ratingScale.max>h)&&e.push(`Component "${s.name}" in "${a.name}" must use ratings between ${u} and ${h}.`),s.ratingScale.min>s.ratingScale.max&&e.push(`Component "${s.name}" in "${a.name}" must have a minimum rating less than or equal to the maximum.`),(s.weightPercent<0||s.weightPercent>100)&&e.push(`Component "${s.name}" in "${a.name}" must use a weight between 0 and 100%.`)}let i=new Set;for(let a of c.nonInspectedItemTypes){let t=a.name.trim();t||e.push("Non-inspected item types must have a name."),i.has(t)&&e.push(`Non-inspected item type name "${t}" is duplicated.`),i.add(t)}let m=new Map(R(c).map(a=>[a.id,a.kind]));for(let a of c.collections){let t=new Set;for(let s of a.items){let d=s.name.trim();d||e.push(`Collection "${a.name}": items must have a name.`),t.has(d)&&e.push(`Collection "${a.name}": item name "${d}" is duplicated.`),t.add(d);let p=m.get(s.typeId);p==="point"&&(s.station===void 0||Number.isNaN(s.station))&&e.push(`Collection "${a.name}": point item "${s.name}" must have a station value.`),p==="linear"&&(!s.startStationItemId||!s.endStationItemId)&&e.push(`Collection "${a.name}": linear item "${s.name}" must reference start and end station items.`)}e.push(...E(a,m))}return e}var y=class extends o.PluginSettingTab{constructor(e,n){super(e,n),this.plugin=n}display(){let{containerEl:e}=this;e.empty(),new o.Setting(e).setName("Inspection network").setHeading(),e.createEl("p",{text:"Define the inspection structure here. Start by naming item types, then assemble collections that map your network."}),this.renderSetupOverview(e),this.renderInspectedItemTypes(e),this.renderNonInspectedItemTypes(e),this.renderCollections(e),this.renderValidation(e)}renderSetupOverview(e){new o.Setting(e).setName("Setup checklist").setHeading();let n=e.createEl("ol");n.createEl("li",{text:"Create inspected item types and their rated components."}),n.createEl("li",{text:"Add non-inspected types for markers or reference items (optional)."}),n.createEl("li",{text:"Build collections by adding point items (stations) and linear items (segments)."}),n.createEl("li",{text:"Review validation feedback at the bottom before running inspections."})}renderInspectedItemTypes(e){new o.Setting(e).setName("Inspected item types").setHeading(),e.createEl("p",{text:`Define up to ${f} inspected facility types, each with rated components.`}),e.createEl("p",{text:`Currently using ${this.plugin.settings.inspectedItemTypes.length} of ${f}.`}),new o.Setting(e).setName("Add inspected item type").setDesc("Create a new inspected type for point or linear facilities.").addButton(n=>{n.setButtonText("Add").setDisabled(this.plugin.settings.inspectedItemTypes.length>=f).onClick(async()=>{this.plugin.settings.inspectedItemTypes.push({id:I(),name:"",kind:"point",components:[]}),await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.inspectedItemTypes.forEach((n,i)=>{this.renderInspectedItemType(e,n,i)})}renderInspectedItemType(e,n,i){new o.Setting(e).setName(`Inspected type ${i+1}`).setHeading();let m=e.createEl("p"),a=()=>{let t=n.components.length,s=n.components.reduce((d,p)=>{let l=Number.isFinite(p.weightPercent)?p.weightPercent:0;return d+l},0);m.setText(`Components: ${t}. Total weight: ${s}%.`)};a(),new o.Setting(e).setName("Type name").setDesc("Use a unique name within inspected types.").addText(t=>t.setPlaceholder("Canal check structure").setValue(n.name).onChange(async s=>{n.name=s,await this.plugin.saveSettings()})),new o.Setting(e).setName("Type kind").setDesc("Point items have a single station. Linear items connect two stations.").addDropdown(t=>{t.addOption("point","Point").addOption("linear","Linear").setValue(n.kind).onChange(async s=>{n.kind=s,await this.plugin.saveSettings(),this.display()})}),new o.Setting(e).setName("Remove inspected type").setDesc("Delete this inspected item type and its components.").addButton(t=>t.setButtonText("Remove").setWarning().onClick(async()=>{this.plugin.settings.inspectedItemTypes=this.plugin.settings.inspectedItemTypes.filter(s=>s.id!==n.id),await this.plugin.saveSettings(),this.display()})),new o.Setting(e).setName("Rated components").setHeading(),e.createEl("p",{text:"Each component should have a name, rating scale, and weight that contributes to the total score."}),new o.Setting(e).setName("Add component").setDesc("Add a rated component for this inspected type.").addButton(t=>{t.setButtonText("Add").onClick(async()=>{n.components.push({id:I(),name:"",ratingScale:{min:u,max:h},weightPercent:0,allowNotInspectedUsePrevious:!1}),await this.plugin.saveSettings(),this.display()})}),n.components.forEach(t=>{this.renderComponent(e,n,t,a)})}renderComponent(e,n,i,m){new o.Setting(e).setName("Component name").setDesc("Short label for this rated component.").addText(t=>t.setValue(i.name).onChange(async s=>{i.name=s,await this.plugin.saveSettings()}));let a=new o.Setting(e).setName("Rating scale").setDesc(`Choose a numeric scale between ${u} and ${h}.`);a.addText(t=>{t.setValue(i.ratingScale.min.toString()),t.setPlaceholder("Min"),t.inputEl.type="number",t.inputEl.min=u.toString(),t.inputEl.max=h.toString(),t.onChange(async s=>{i.ratingScale.min=Number(s),await this.plugin.saveSettings()})}),a.addText(t=>{t.setValue(i.ratingScale.max.toString()),t.setPlaceholder("Max"),t.inputEl.type="number",t.inputEl.min=u.toString(),t.inputEl.max=h.toString(),t.onChange(async s=>{i.ratingScale.max=Number(s),await this.plugin.saveSettings()})}),new o.Setting(e).setName("Weight percent").setDesc("Set a weight between 0 and 100. Aim for totals to equal 100%.").addText(t=>{t.setValue(i.weightPercent.toString()),t.inputEl.type="number",t.inputEl.min="0",t.inputEl.max="100",t.onChange(async s=>{i.weightPercent=Number(s),await this.plugin.saveSettings(),m()})}).addButton(t=>t.setButtonText("Remove").setWarning().onClick(async()=>{n.components=n.components.filter(s=>s.id!==i.id),await this.plugin.saveSettings(),this.display()})),new o.Setting(e).setName("Allow not inspected/use previous").setDesc("Enable when the component can be marked not inspected and reuse the previous rating.").addToggle(t=>{t.setValue(i.allowNotInspectedUsePrevious).onChange(async s=>{i.allowNotInspectedUsePrevious=s,await this.plugin.saveSettings()})})}renderNonInspectedItemTypes(e){new o.Setting(e).setName("Non-inspected item types").setHeading(),e.createEl("p",{text:"Define navigation or reference items that are not directly inspected."}),new o.Setting(e).setName("Add non-inspected item type").setDesc("Create a new non-inspected point or linear item type.").addButton(n=>{n.setButtonText("Add").onClick(async()=>{this.plugin.settings.nonInspectedItemTypes.push({id:I(),name:"",kind:"point"}),await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.nonInspectedItemTypes.forEach((n,i)=>{this.renderNonInspectedItemType(e,n,i)})}renderNonInspectedItemType(e,n,i){new o.Setting(e).setName(`Non-inspected type ${i+1}`).setHeading(),new o.Setting(e).setName("Type name").setDesc("Use a unique name within non-inspected types.").addText(m=>m.setPlaceholder("Station marker").setValue(n.name).onChange(async a=>{n.name=a,await this.plugin.saveSettings()})),new o.Setting(e).setName("Type kind").setDesc("Point items have a single station. Linear items connect two stations.").addDropdown(m=>{m.addOption("point","Point").addOption("linear","Linear").setValue(n.kind).onChange(async a=>{n.kind=a,await this.plugin.saveSettings(),this.display()})}),new o.Setting(e).setName("Remove non-inspected type").setDesc("Delete this non-inspected item type.").addButton(m=>m.setButtonText("Remove").setWarning().onClick(async()=>{this.plugin.settings.nonInspectedItemTypes=this.plugin.settings.nonInspectedItemTypes.filter(a=>a.id!==n.id),await this.plugin.saveSettings(),this.display()}))}renderCollections(e){new o.Setting(e).setName("Collections").setHeading(),e.createEl("p",{text:"Define each connected linear network (for example, a single canal)."}),e.createEl("p",{text:"Tip: add point items first so linear items can reference start and end stations."}),new o.Setting(e).setName("Add collection").setDesc("Create a named collection of inspected and reference items.").addButton(n=>{n.setButtonText("Add").onClick(async()=>{this.plugin.settings.collections.push({id:I(),name:"",items:[]}),await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.collections.forEach((n,i)=>{this.renderCollection(e,n,i)})}renderCollection(e,n,i){if(new o.Setting(e).setName(`Collection ${i+1}`).setHeading(),new o.Setting(e).setName("Collection name").setDesc("Names are used to group items into connected networks.").addText(m=>m.setPlaceholder("Example canal").setValue(n.name).onChange(async a=>{n.name=a,await this.plugin.saveSettings()})),new o.Setting(e).setName("Remove collection").setDesc("Delete this collection and its items.").addButton(m=>m.setButtonText("Remove").setWarning().onClick(async()=>{this.plugin.settings.collections=this.plugin.settings.collections.filter(a=>a.id!==n.id),await this.plugin.saveSettings(),this.display()})),new o.Setting(e).setName("Add item").setDesc("Add an inspected or reference item to this collection.").addButton(m=>{m.setButtonText("Add").onClick(async()=>{let t=this.getItemTypeSummaries()[0],s=t?t.id:"";n.items.push({id:I(),name:"",typeId:s,station:void 0}),await this.plugin.saveSettings(),this.display()})}),n.items.length===0){e.createEl("p",{text:"No items yet. Add an item to begin describing stations and segments."});return}n.items.forEach((m,a)=>{this.renderCollectionItem(e,n,m,a)})}renderCollectionItem(e,n,i,m){new o.Setting(e).setName(`Item ${m+1}`).setHeading(),new o.Setting(e).setName("Item name").setDesc("Item names must be unique within a collection.").addText(t=>t.setPlaceholder("Reach 1").setValue(i.name).onChange(async s=>{i.name=s,await this.plugin.saveSettings()})),new o.Setting(e).setName("Item type").setDesc("Choose the inspected or non-inspected type for this item.").addDropdown(t=>{var d;let s=this.getItemTypeSummaries();if(s.length===0){t.addOption("","Add item types first"),t.setValue(""),t.setDisabled(!0);return}s.forEach(p=>{t.addOption(p.id,`${p.name||"(unnamed)"} (${p.kind})`)}),t.setValue(i.typeId||((d=s[0])==null?void 0:d.id)||""),t.onChange(async p=>{i.typeId=p;let l=this.getItemKind(p);l==="point"?(i.startStationItemId=void 0,i.endStationItemId=void 0):l==="linear"&&(i.station=void 0),await this.plugin.saveSettings(),this.display()})});let a=this.getItemKind(i.typeId);if(a==="point"&&new o.Setting(e).setName("Station").setDesc("Station value for this point item.").addText(t=>{var s,d;t.setValue((d=(s=i.station)==null?void 0:s.toString())!=null?d:""),t.setPlaceholder("0.0"),t.inputEl.type="number",t.onChange(async p=>{i.station=p===""?void 0:Number(p),await this.plugin.saveSettings()})}),a==="linear"){let t=n.items.filter(d=>this.getItemKind(d.typeId)==="point");e.createEl("p",{text:`Available point items: ${t.length}.`});let s=t.map(d=>({id:d.id,label:`${d.name||"(unnamed)"} ${d.station!==void 0?`@ ${d.station}`:"(no station)"}`}));new o.Setting(e).setName("Start station item").setDesc("Select the point item that defines the start station.").addDropdown(d=>{var p,l;if(s.length===0){d.addOption("","Add a point item first"),d.setValue(""),d.setDisabled(!0);return}s.forEach(g=>d.addOption(g.id,g.label)),d.setValue(i.startStationItemId||((l=(p=s[0])==null?void 0:p.id)!=null?l:"")).onChange(async g=>{i.startStationItemId=g,await this.plugin.saveSettings()})}),new o.Setting(e).setName("End station item").setDesc("Select the point item that defines the end station.").addDropdown(d=>{var p,l;if(s.length===0){d.addOption("","Add a point item first"),d.setValue(""),d.setDisabled(!0);return}s.forEach(g=>d.addOption(g.id,g.label)),d.setValue(i.endStationItemId||((l=(p=s[0])==null?void 0:p.id)!=null?l:"")).onChange(async g=>{i.endStationItemId=g,await this.plugin.saveSettings()})})}new o.Setting(e).setName("Remove item").setDesc("Delete this item from the collection.").addButton(t=>t.setButtonText("Remove").setWarning().onClick(async()=>{n.items=n.items.filter(s=>s.id!==i.id),await this.plugin.saveSettings(),this.display()}))}renderValidation(e){let n=C(this.plugin.settings);if(new o.Setting(e).setName("Validation").setHeading(),e.createEl("p",{text:"Resolve any issues below to keep inspections consistent and connected."}),n.length===0){e.createEl("p",{text:"All settings are valid."});return}let i=e.createEl("ul");n.forEach(m=>{i.createEl("li",{text:m})})}getItemTypeSummaries(){let e=this.plugin.settings.inspectedItemTypes.map(i=>({id:i.id,name:i.name,kind:i.kind})),n=this.plugin.settings.nonInspectedItemTypes.map(i=>({id:i.id,name:i.name,kind:i.kind}));return[...e,...n]}getItemKind(e){let n=this.getItemTypeSummaries().find(i=>i.id===e);return n==null?void 0:n.kind}};var S=class extends k.Plugin{async onload(){await this.loadSettings(),this.addSettingTab(new y(this.app,this))}async loadSettings(){let e=await this.loadData();this.settings={...v,...e}}async saveSettings(){await this.saveData(this.settings)}};
