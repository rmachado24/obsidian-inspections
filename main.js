/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var S=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var A=(r,e)=>{for(var t in e)S(r,t,{get:e[t],enumerable:!0})},P=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of x(e))!$.call(r,a)&&a!==t&&S(r,a,{get:()=>e[a],enumerable:!(i=b(e,a))||i.enumerable});return r};var M=r=>P(S({},"__esModule",{value:!0}),r);var B={};A(B,{default:()=>y});module.exports=M(B);var k=require("obsidian");var N={inspectedItemTypes:[],nonInspectedItemTypes:[],collections:[]},v=10,u=0,h=10;var d=require("obsidian");function I(){return typeof crypto!="undefined"&&"randomUUID"in crypto?crypto.randomUUID():`id-${Date.now()}-${Math.random().toString(16).slice(2)}`}function R(r){let e=r.inspectedItemTypes.map(i=>({id:i.id,name:i.name,kind:i.kind})),t=r.nonInspectedItemTypes.map(i=>({id:i.id,name:i.name,kind:i.kind}));return[...e,...t]}function V(r,e){var g,l,w;let t=[],i=r.items.filter(p=>e.get(p.typeId)==="point"),a=new Set(i.map(p=>p.id)),n=new Set,s=new Map;for(let p of r.items)if(e.get(p.typeId)==="linear"){if(!p.startStationItemId||!p.endStationItemId){t.push(`Collection "${r.name}": linear item "${p.name}" must have both a start and end station item.`);continue}if(!a.has(p.startStationItemId)||!a.has(p.endStationItemId)){t.push(`Collection "${r.name}": linear item "${p.name}" must reference point items for start and end.`);continue}n.add(p.startStationItemId),n.add(p.endStationItemId),s.has(p.startStationItemId)||s.set(p.startStationItemId,new Set),s.has(p.endStationItemId)||s.set(p.endStationItemId,new Set),(g=s.get(p.startStationItemId))==null||g.add(p.endStationItemId),(l=s.get(p.endStationItemId))==null||l.add(p.startStationItemId)}if(n.size<=1)return t;let[o]=n;if(!o)return t;let m=new Set,c=[o];for(;c.length>0;){let p=c.shift();if(!p||m.has(p))continue;m.add(p);let D=(w=s.get(p))!=null?w:new Set;for(let T of D)m.has(T)||c.push(T)}return m.size!==n.size&&t.push(`Collection "${r.name}": the linear network is not fully connected. Ensure each linear item connects through stationed point items.`),t}function C(r){let e=[],t=new Set;for(let n of r.inspectedItemTypes){let s=n.name.trim();s||e.push("Inspected item types must have a name."),t.has(s)&&e.push(`Inspected item type name "${s}" is duplicated.`),t.add(s);for(let o of n.components)o.name.trim()||e.push(`Component names for "${n.name}" cannot be empty.`),(o.ratingScale.min<u||o.ratingScale.max>h)&&e.push(`Component "${o.name}" in "${n.name}" must use ratings between ${u} and ${h}.`),o.ratingScale.min>o.ratingScale.max&&e.push(`Component "${o.name}" in "${n.name}" must have a minimum rating less than or equal to the maximum.`),(o.weightPercent<0||o.weightPercent>100)&&e.push(`Component "${o.name}" in "${n.name}" must use a weight between 0 and 100%.`)}let i=new Set;for(let n of r.nonInspectedItemTypes){let s=n.name.trim();s||e.push("Non-inspected item types must have a name."),i.has(s)&&e.push(`Non-inspected item type name "${s}" is duplicated.`),i.add(s)}let a=new Map(R(r).map(n=>[n.id,n.kind]));for(let n of r.collections){let s=new Set;for(let o of n.items){let m=o.name.trim();m||e.push(`Collection "${n.name}": items must have a name.`),s.has(m)&&e.push(`Collection "${n.name}": item name "${m}" is duplicated.`),s.add(m);let c=a.get(o.typeId);c==="point"&&(o.station===void 0||Number.isNaN(o.station))&&e.push(`Collection "${n.name}": point item "${o.name}" must have a station value.`),c==="linear"&&(!o.startStationItemId||!o.endStationItemId)&&e.push(`Collection "${n.name}": linear item "${o.name}" must reference start and end station items.`)}e.push(...V(n,a))}return e}var f=class extends d.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new d.Setting(e).setName("Inspection network").setHeading(),this.renderInspectedItemTypes(e),this.renderNonInspectedItemTypes(e),this.renderCollections(e),this.renderValidation(e)}renderInspectedItemTypes(e){new d.Setting(e).setName("Inspected item types").setHeading(),e.createEl("p",{text:"Define up to 10 inspected facility types, each with rated components."}),new d.Setting(e).setName("Add inspected item type").setDesc("Create a new inspected type for point or linear facilities.").addButton(t=>{t.setButtonText("Add").setDisabled(this.plugin.settings.inspectedItemTypes.length>=v).onClick(async()=>{this.plugin.settings.inspectedItemTypes.push({id:I(),name:"",kind:"point",components:[]}),await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.inspectedItemTypes.forEach((t,i)=>{this.renderInspectedItemType(e,t,i)})}renderInspectedItemType(e,t,i){new d.Setting(e).setName(`Inspected type ${i+1}`).setHeading(),new d.Setting(e).setName("Type name").setDesc("Use a unique name within inspected types.").addText(a=>a.setPlaceholder("Canal check structure").setValue(t.name).onChange(async n=>{t.name=n,await this.plugin.saveSettings()})),new d.Setting(e).setName("Type kind").setDesc("Point items have a single station. Linear items connect two stations.").addDropdown(a=>{a.addOption("point","Point").addOption("linear","Linear").setValue(t.kind).onChange(async n=>{t.kind=n,await this.plugin.saveSettings(),this.display()})}),new d.Setting(e).setName("Remove inspected type").setDesc("Delete this inspected item type.").addButton(a=>a.setButtonText("Remove").setWarning().onClick(async()=>{this.plugin.settings.inspectedItemTypes=this.plugin.settings.inspectedItemTypes.filter(n=>n.id!==t.id),await this.plugin.saveSettings(),this.display()})),new d.Setting(e).setName("Rated components").setHeading(),new d.Setting(e).setName("Add component").setDesc("Add a rated component for this inspected type.").addButton(a=>{a.setButtonText("Add").onClick(async()=>{t.components.push({id:I(),name:"",ratingScale:{min:u,max:h},weightPercent:0,allowNotInspectedUsePrevious:!1}),await this.plugin.saveSettings(),this.display()})}),t.components.forEach(a=>{this.renderComponent(e,t,a)})}renderComponent(e,t,i){new d.Setting(e).setName("Component name").setDesc("Short label for this rated component.").addText(n=>n.setValue(i.name).onChange(async s=>{i.name=s,await this.plugin.saveSettings()}));let a=new d.Setting(e).setName("Rating scale").setDesc(`Choose a numeric scale between ${u} and ${h}.`);a.addText(n=>{n.setValue(i.ratingScale.min.toString()),n.inputEl.type="number",n.inputEl.min=u.toString(),n.inputEl.max=h.toString(),n.onChange(async s=>{i.ratingScale.min=Number(s),await this.plugin.saveSettings()})}),a.addText(n=>{n.setValue(i.ratingScale.max.toString()),n.inputEl.type="number",n.inputEl.min=u.toString(),n.inputEl.max=h.toString(),n.onChange(async s=>{i.ratingScale.max=Number(s),await this.plugin.saveSettings()})}),new d.Setting(e).setName("Weight percent").setDesc("Set a universal weight for this component.").addText(n=>{n.setValue(i.weightPercent.toString()),n.inputEl.type="number",n.inputEl.min="0",n.inputEl.max="100",n.onChange(async s=>{i.weightPercent=Number(s),await this.plugin.saveSettings()})}).addButton(n=>n.setButtonText("Remove").setWarning().onClick(async()=>{t.components=t.components.filter(s=>s.id!==i.id),await this.plugin.saveSettings(),this.display()})),new d.Setting(e).setName("Allow not inspected/use previous").setDesc("Enable when the component can be marked not inspected and reuse the previous rating.").addToggle(n=>{n.setValue(i.allowNotInspectedUsePrevious).onChange(async s=>{i.allowNotInspectedUsePrevious=s,await this.plugin.saveSettings()})})}renderNonInspectedItemTypes(e){new d.Setting(e).setName("Non-inspected item types").setHeading(),e.createEl("p",{text:"Define navigation or reference items that are not directly inspected."}),new d.Setting(e).setName("Add non-inspected item type").setDesc("Create a new non-inspected point or linear item type.").addButton(t=>{t.setButtonText("Add").onClick(async()=>{this.plugin.settings.nonInspectedItemTypes.push({id:I(),name:"",kind:"point"}),await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.nonInspectedItemTypes.forEach((t,i)=>{this.renderNonInspectedItemType(e,t,i)})}renderNonInspectedItemType(e,t,i){new d.Setting(e).setName(`Non-inspected type ${i+1}`).setHeading(),new d.Setting(e).setName("Type name").setDesc("Use a unique name within non-inspected types.").addText(a=>a.setPlaceholder("Station marker").setValue(t.name).onChange(async n=>{t.name=n,await this.plugin.saveSettings()})),new d.Setting(e).setName("Type kind").setDesc("Point items have a single station. Linear items connect two stations.").addDropdown(a=>{a.addOption("point","Point").addOption("linear","Linear").setValue(t.kind).onChange(async n=>{t.kind=n,await this.plugin.saveSettings(),this.display()})}),new d.Setting(e).setName("Remove non-inspected type").setDesc("Delete this non-inspected item type.").addButton(a=>a.setButtonText("Remove").setWarning().onClick(async()=>{this.plugin.settings.nonInspectedItemTypes=this.plugin.settings.nonInspectedItemTypes.filter(n=>n.id!==t.id),await this.plugin.saveSettings(),this.display()}))}renderCollections(e){new d.Setting(e).setName("Collections").setHeading(),e.createEl("p",{text:"Define each connected linear network (for example, a single canal)."}),new d.Setting(e).setName("Add collection").setDesc("Create a named collection of inspected and reference items.").addButton(t=>{t.setButtonText("Add").onClick(async()=>{this.plugin.settings.collections.push({id:I(),name:"",items:[]}),await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.collections.forEach((t,i)=>{this.renderCollection(e,t,i)})}renderCollection(e,t,i){if(new d.Setting(e).setName(`Collection ${i+1}`).setHeading(),new d.Setting(e).setName("Collection name").setDesc("Names are used to group items into connected networks.").addText(a=>a.setPlaceholder("Example canal").setValue(t.name).onChange(async n=>{t.name=n,await this.plugin.saveSettings()})),new d.Setting(e).setName("Remove collection").setDesc("Delete this collection and its items.").addButton(a=>a.setButtonText("Remove").setWarning().onClick(async()=>{this.plugin.settings.collections=this.plugin.settings.collections.filter(n=>n.id!==t.id),await this.plugin.saveSettings(),this.display()})),new d.Setting(e).setName("Add item").setDesc("Add an inspected or reference item to this collection.").addButton(a=>{a.setButtonText("Add").onClick(async()=>{let s=this.getItemTypeSummaries()[0],o=s?s.id:"";t.items.push({id:I(),name:"",typeId:o,station:void 0}),await this.plugin.saveSettings(),this.display()})}),t.items.length===0){e.createEl("p",{text:"No items yet. Add an item to begin describing stations and segments."});return}t.items.forEach((a,n)=>{this.renderCollectionItem(e,t,a,n)})}renderCollectionItem(e,t,i,a){new d.Setting(e).setName(`Item ${a+1}`).setHeading(),new d.Setting(e).setName("Item name").setDesc("Item names must be unique within a collection.").addText(s=>s.setPlaceholder("Reach 1").setValue(i.name).onChange(async o=>{i.name=o,await this.plugin.saveSettings()})),new d.Setting(e).setName("Item type").setDesc("Choose the inspected or non-inspected type for this item.").addDropdown(s=>{var m;let o=this.getItemTypeSummaries();if(o.length===0){s.addOption("","Add item types first"),s.setValue(""),s.setDisabled(!0);return}o.forEach(c=>{s.addOption(c.id,`${c.name||"(unnamed)"} (${c.kind})`)}),s.setValue(i.typeId||((m=o[0])==null?void 0:m.id)||""),s.onChange(async c=>{i.typeId=c;let g=this.getItemKind(c);g==="point"?(i.startStationItemId=void 0,i.endStationItemId=void 0):g==="linear"&&(i.station=void 0),await this.plugin.saveSettings(),this.display()})});let n=this.getItemKind(i.typeId);if(n==="point"&&new d.Setting(e).setName("Station").setDesc("Station value for this point item.").addText(s=>{var o,m;s.setValue((m=(o=i.station)==null?void 0:o.toString())!=null?m:""),s.inputEl.type="number",s.onChange(async c=>{i.station=c===""?void 0:Number(c),await this.plugin.saveSettings()})}),n==="linear"){let o=t.items.filter(m=>this.getItemKind(m.typeId)==="point").map(m=>({id:m.id,label:`${m.name||"(unnamed)"} ${m.station!==void 0?`@ ${m.station}`:"(no station)"}`}));new d.Setting(e).setName("Start station item").setDesc("Select the point item that defines the start station.").addDropdown(m=>{var c,g;if(o.length===0){m.addOption("","Add a point item first"),m.setValue(""),m.setDisabled(!0);return}o.forEach(l=>m.addOption(l.id,l.label)),m.setValue(i.startStationItemId||((g=(c=o[0])==null?void 0:c.id)!=null?g:"")).onChange(async l=>{i.startStationItemId=l,await this.plugin.saveSettings()})}),new d.Setting(e).setName("End station item").setDesc("Select the point item that defines the end station.").addDropdown(m=>{var c,g;if(o.length===0){m.addOption("","Add a point item first"),m.setValue(""),m.setDisabled(!0);return}o.forEach(l=>m.addOption(l.id,l.label)),m.setValue(i.endStationItemId||((g=(c=o[0])==null?void 0:c.id)!=null?g:"")).onChange(async l=>{i.endStationItemId=l,await this.plugin.saveSettings()})})}new d.Setting(e).setName("Remove item").setDesc("Delete this item from the collection.").addButton(s=>s.setButtonText("Remove").setWarning().onClick(async()=>{t.items=t.items.filter(o=>o.id!==i.id),await this.plugin.saveSettings(),this.display()}))}renderValidation(e){let t=C(this.plugin.settings);if(new d.Setting(e).setName("Validation").setHeading(),t.length===0){e.createEl("p",{text:"All settings are valid."});return}let i=e.createEl("ul");t.forEach(a=>{i.createEl("li",{text:a})})}getItemTypeSummaries(){let e=this.plugin.settings.inspectedItemTypes.map(i=>({id:i.id,name:i.name,kind:i.kind})),t=this.plugin.settings.nonInspectedItemTypes.map(i=>({id:i.id,name:i.name,kind:i.kind}));return[...e,...t]}getItemKind(e){let t=this.getItemTypeSummaries().find(i=>i.id===e);return t==null?void 0:t.kind}};var y=class extends k.Plugin{async onload(){await this.loadSettings(),this.addSettingTab(new f(this.app,this))}async loadSettings(){let e=await this.loadData();this.settings={...N,...e}}async saveSettings(){await this.saveData(this.settings)}};
