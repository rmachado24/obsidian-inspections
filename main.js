/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var w=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var B=Object.prototype.hasOwnProperty;var V=(o,e)=>{for(var t in e)w(o,t,{get:e[t],enumerable:!0})},M=(o,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of $(e))!B.call(o,s)&&s!==t&&w(o,s,{get:()=>e[s],enumerable:!(n=A(e,s))||n.enumerable});return o};var E=o=>M(w({},"__esModule",{value:!0}),o);var X={};V(X,{default:()=>S});module.exports=E(X);var R=require("obsidian");var T={inspectedItemTypes:[],nonInspectedItemTypes:[],collections:[]},b=10,g=0,u=10;function N(){return{schemaVersion:1,inspectedItemTypeIds:[],nonInspectedItemTypeIds:[],itemTypes:{},componentIdsByItemType:{},components:{},collectionIds:[],collections:{},items:{}}}function v(o){let e=N();return o.inspectedItemTypes.forEach(t=>{e.inspectedItemTypeIds.push(t.id),e.itemTypes[t.id]={id:t.id,name:t.name,kind:t.kind,inspected:!0},e.componentIdsByItemType[t.id]=[],t.components.forEach(n=>{e.componentIdsByItemType[t.id].push(n.id),e.components[n.id]={id:n.id,itemTypeId:t.id,name:n.name,ratingScale:{min:n.ratingScale.min,max:n.ratingScale.max},weightPercent:n.weightPercent,allowNotInspectedUsePrevious:n.allowNotInspectedUsePrevious}})}),o.nonInspectedItemTypes.forEach(t=>{e.nonInspectedItemTypeIds.push(t.id),e.itemTypes[t.id]={id:t.id,name:t.name,kind:t.kind,inspected:!1}}),o.collections.forEach(t=>{e.collectionIds.push(t.id),e.collections[t.id]={id:t.id,name:t.name,itemIds:[]},t.items.forEach(n=>{e.collections[t.id].itemIds.push(n.id),e.items[n.id]={id:n.id,name:n.name,typeId:n.typeId,station:n.station,startStationItemId:n.startStationItemId,endStationItemId:n.endStationItemId}})}),e}function D(o){let e=o.inspectedItemTypeIds.map(s=>H(o,s)).filter(s=>!!s),t=o.nonInspectedItemTypeIds.map(s=>K(o,s)).filter(s=>!!s),n=o.collectionIds.map(s=>L(o,s)).filter(s=>!!s);return{inspectedItemTypes:e,nonInspectedItemTypes:t,collections:n}}function H(o,e){var i;let t=o.itemTypes[e];if(!t||!t.inspected)return null;let s=((i=o.componentIdsByItemType[e])!=null?i:[]).map(a=>U(o,a,e)).filter(a=>!!a);return{id:t.id,name:t.name,kind:t.kind,components:s}}function K(o,e){let t=o.itemTypes[e];return!t||t.inspected?null:{id:t.id,name:t.name,kind:t.kind}}function U(o,e,t){var s,i;let n=o.components[e];return!n||n.itemTypeId!==t?null:{id:n.id,name:n.name,ratingScale:{min:(s=n.ratingScale.min)!=null?s:g,max:(i=n.ratingScale.max)!=null?i:u},weightPercent:n.weightPercent,allowNotInspectedUsePrevious:n.allowNotInspectedUsePrevious}}function L(o,e){var s;let t=o.collections[e];if(!t)return null;let n=((s=t.itemIds)!=null?s:[]).map(i=>_(o,i)).filter(i=>!!i);return{id:t.id,name:t.name,items:n}}function _(o,e){let t=o.items[e];return t?{id:t.id,name:t.name,typeId:t.typeId,station:t.station,startStationItemId:t.startStationItemId,endStationItemId:t.endStationItemId}:null}function G(o){if(!o||typeof o!="object")return!1;let e=o;return e.schemaVersion===1&&typeof e.database=="object"}var f=class{constructor(e){this.settings={...T};this.database=N();this.plugin=e}async load(){let e=await this.plugin.loadData();if(G(e)){this.database=e.database,this.settings=D(this.database);return}let t=e!=null?e:{};this.settings={...T,...t},this.database=v(this.settings),await this.save()}async saveFromSettings(e){this.settings=e,this.database=v(e),await this.save()}async save(){await this.plugin.saveData({schemaVersion:1,database:this.database})}};var m=require("obsidian");function h(){return typeof crypto!="undefined"&&"randomUUID"in crypto?crypto.randomUUID():`id-${Date.now()}-${Math.random().toString(16).slice(2)}`}function O(o){let e=o.inspectedItemTypes.map(n=>({id:n.id,name:n.name,kind:n.kind})),t=o.nonInspectedItemTypes.map(n=>({id:n.id,name:n.name,kind:n.kind}));return[...e,...t]}function W(o,e){var I,l,C;let t=[],n=o.items.filter(p=>e.get(p.typeId)==="point"),s=new Set(n.map(p=>p.id)),i=new Set,a=new Map;for(let p of o.items)if(e.get(p.typeId)==="linear"){if(!p.startStationItemId||!p.endStationItemId){t.push(`Collection "${o.name}": linear item "${p.name}" must have both a start and end station item.`);continue}if(!s.has(p.startStationItemId)||!s.has(p.endStationItemId)){t.push(`Collection "${o.name}": linear item "${p.name}" must reference point items for start and end.`);continue}i.add(p.startStationItemId),i.add(p.endStationItemId),a.has(p.startStationItemId)||a.set(p.startStationItemId,new Set),a.has(p.endStationItemId)||a.set(p.endStationItemId,new Set),(I=a.get(p.startStationItemId))==null||I.add(p.endStationItemId),(l=a.get(p.endStationItemId))==null||l.add(p.startStationItemId)}if(i.size<=1)return t;let[d]=i;if(!d)return t;let r=new Set,c=[d];for(;c.length>0;){let p=c.shift();if(!p||r.has(p))continue;r.add(p);let P=(C=a.get(p))!=null?C:new Set;for(let k of P)r.has(k)||c.push(k)}return r.size!==i.size&&t.push(`Collection "${o.name}": the linear network is not fully connected. Ensure each linear item connects through stationed point items.`),t}function x(o){let e=[],t=new Set;for(let i of o.inspectedItemTypes){let a=i.name.trim();a||e.push("Inspected item types must have a name."),t.has(a)&&e.push(`Inspected item type name "${a}" is duplicated.`),t.add(a);for(let d of i.components)d.name.trim()||e.push(`Component names for "${i.name}" cannot be empty.`),(d.ratingScale.min<g||d.ratingScale.max>u)&&e.push(`Component "${d.name}" in "${i.name}" must use ratings between ${g} and ${u}.`),d.ratingScale.min>d.ratingScale.max&&e.push(`Component "${d.name}" in "${i.name}" must have a minimum rating less than or equal to the maximum.`),(d.weightPercent<0||d.weightPercent>100)&&e.push(`Component "${d.name}" in "${i.name}" must use a weight between 0 and 100%.`)}let n=new Set;for(let i of o.nonInspectedItemTypes){let a=i.name.trim();a||e.push("Non-inspected item types must have a name."),n.has(a)&&e.push(`Non-inspected item type name "${a}" is duplicated.`),n.add(a)}let s=new Map(O(o).map(i=>[i.id,i.kind]));for(let i of o.collections){let a=new Set;for(let d of i.items){let r=d.name.trim();r||e.push(`Collection "${i.name}": items must have a name.`),a.has(r)&&e.push(`Collection "${i.name}": item name "${r}" is duplicated.`),a.add(r);let c=s.get(d.typeId);c==="point"&&(d.station===void 0||Number.isNaN(d.station))&&e.push(`Collection "${i.name}": point item "${d.name}" must have a station value.`),c==="linear"&&(!d.startStationItemId||!d.endStationItemId)&&e.push(`Collection "${i.name}": linear item "${d.name}" must reference start and end station items.`)}e.push(...W(i,s))}return e}var y=class extends m.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new m.Setting(e).setName("Inspection network").setHeading(),this.renderInspectedItemTypes(e),this.renderNonInspectedItemTypes(e),this.renderCollections(e),this.renderValidation(e)}renderInspectedItemTypes(e){new m.Setting(e).setName("Inspected item types").setHeading(),e.createEl("p",{text:"Define up to 10 inspected facility types, each with rated components."}),new m.Setting(e).setName("Add inspected item type").setDesc("Create a new inspected type for point or linear facilities.").addButton(t=>{t.setButtonText("Add").setDisabled(this.plugin.settings.inspectedItemTypes.length>=b).onClick(async()=>{this.plugin.settings.inspectedItemTypes.push({id:h(),name:"",kind:"point",components:[]}),await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.inspectedItemTypes.forEach((t,n)=>{this.renderInspectedItemType(e,t,n)})}renderInspectedItemType(e,t,n){new m.Setting(e).setName(`Inspected type ${n+1}`).setHeading(),new m.Setting(e).setName("Type name").setDesc("Use a unique name within inspected types.").addText(s=>s.setPlaceholder("Canal check structure").setValue(t.name).onChange(async i=>{t.name=i,await this.plugin.saveSettings()})),new m.Setting(e).setName("Type kind").setDesc("Point items have a single station. Linear items connect two stations.").addDropdown(s=>{s.addOption("point","Point").addOption("linear","Linear").setValue(t.kind).onChange(async i=>{t.kind=i,await this.plugin.saveSettings(),this.display()})}),new m.Setting(e).setName("Remove inspected type").setDesc("Delete this inspected item type.").addButton(s=>s.setButtonText("Remove").setWarning().onClick(async()=>{this.plugin.settings.inspectedItemTypes=this.plugin.settings.inspectedItemTypes.filter(i=>i.id!==t.id),await this.plugin.saveSettings(),this.display()})),new m.Setting(e).setName("Rated components").setHeading(),new m.Setting(e).setName("Add component").setDesc("Add a rated component for this inspected type.").addButton(s=>{s.setButtonText("Add").onClick(async()=>{t.components.push({id:h(),name:"",ratingScale:{min:g,max:u},weightPercent:0,allowNotInspectedUsePrevious:!1}),await this.plugin.saveSettings(),this.display()})}),t.components.forEach(s=>{this.renderComponent(e,t,s)})}renderComponent(e,t,n){new m.Setting(e).setName("Component name").setDesc("Short label for this rated component.").addText(i=>i.setValue(n.name).onChange(async a=>{n.name=a,await this.plugin.saveSettings()}));let s=new m.Setting(e).setName("Rating scale").setDesc(`Choose a numeric scale between ${g} and ${u}.`);s.addText(i=>{i.setValue(n.ratingScale.min.toString()),i.inputEl.type="number",i.inputEl.min=g.toString(),i.inputEl.max=u.toString(),i.onChange(async a=>{n.ratingScale.min=Number(a),await this.plugin.saveSettings()})}),s.addText(i=>{i.setValue(n.ratingScale.max.toString()),i.inputEl.type="number",i.inputEl.min=g.toString(),i.inputEl.max=u.toString(),i.onChange(async a=>{n.ratingScale.max=Number(a),await this.plugin.saveSettings()})}),new m.Setting(e).setName("Weight percent").setDesc("Set a universal weight for this component.").addText(i=>{i.setValue(n.weightPercent.toString()),i.inputEl.type="number",i.inputEl.min="0",i.inputEl.max="100",i.onChange(async a=>{n.weightPercent=Number(a),await this.plugin.saveSettings()})}).addButton(i=>i.setButtonText("Remove").setWarning().onClick(async()=>{t.components=t.components.filter(a=>a.id!==n.id),await this.plugin.saveSettings(),this.display()})),new m.Setting(e).setName("Allow not inspected/use previous").setDesc("Enable when the component can be marked not inspected and reuse the previous rating.").addToggle(i=>{i.setValue(n.allowNotInspectedUsePrevious).onChange(async a=>{n.allowNotInspectedUsePrevious=a,await this.plugin.saveSettings()})})}renderNonInspectedItemTypes(e){new m.Setting(e).setName("Non-inspected item types").setHeading(),e.createEl("p",{text:"Define navigation or reference items that are not directly inspected."}),new m.Setting(e).setName("Add non-inspected item type").setDesc("Create a new non-inspected point or linear item type.").addButton(t=>{t.setButtonText("Add").onClick(async()=>{this.plugin.settings.nonInspectedItemTypes.push({id:h(),name:"",kind:"point"}),await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.nonInspectedItemTypes.forEach((t,n)=>{this.renderNonInspectedItemType(e,t,n)})}renderNonInspectedItemType(e,t,n){new m.Setting(e).setName(`Non-inspected type ${n+1}`).setHeading(),new m.Setting(e).setName("Type name").setDesc("Use a unique name within non-inspected types.").addText(s=>s.setPlaceholder("Station marker").setValue(t.name).onChange(async i=>{t.name=i,await this.plugin.saveSettings()})),new m.Setting(e).setName("Type kind").setDesc("Point items have a single station. Linear items connect two stations.").addDropdown(s=>{s.addOption("point","Point").addOption("linear","Linear").setValue(t.kind).onChange(async i=>{t.kind=i,await this.plugin.saveSettings(),this.display()})}),new m.Setting(e).setName("Remove non-inspected type").setDesc("Delete this non-inspected item type.").addButton(s=>s.setButtonText("Remove").setWarning().onClick(async()=>{this.plugin.settings.nonInspectedItemTypes=this.plugin.settings.nonInspectedItemTypes.filter(i=>i.id!==t.id),await this.plugin.saveSettings(),this.display()}))}renderCollections(e){new m.Setting(e).setName("Collections").setHeading(),e.createEl("p",{text:"Define each connected linear network (for example, a single canal)."}),new m.Setting(e).setName("Add collection").setDesc("Create a named collection of inspected and reference items.").addButton(t=>{t.setButtonText("Add").onClick(async()=>{this.plugin.settings.collections.push({id:h(),name:"",items:[]}),await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.collections.forEach((t,n)=>{this.renderCollection(e,t,n)})}renderCollection(e,t,n){if(new m.Setting(e).setName(`Collection ${n+1}`).setHeading(),new m.Setting(e).setName("Collection name").setDesc("Names are used to group items into connected networks.").addText(s=>s.setPlaceholder("Example canal").setValue(t.name).onChange(async i=>{t.name=i,await this.plugin.saveSettings()})),new m.Setting(e).setName("Remove collection").setDesc("Delete this collection and its items.").addButton(s=>s.setButtonText("Remove").setWarning().onClick(async()=>{this.plugin.settings.collections=this.plugin.settings.collections.filter(i=>i.id!==t.id),await this.plugin.saveSettings(),this.display()})),new m.Setting(e).setName("Add item").setDesc("Add an inspected or reference item to this collection.").addButton(s=>{s.setButtonText("Add").onClick(async()=>{let a=this.getItemTypeSummaries()[0],d=a?a.id:"";t.items.push({id:h(),name:"",typeId:d,station:void 0}),await this.plugin.saveSettings(),this.display()})}),t.items.length===0){e.createEl("p",{text:"No items yet. Add an item to begin describing stations and segments."});return}t.items.forEach((s,i)=>{this.renderCollectionItem(e,t,s,i)})}renderCollectionItem(e,t,n,s){new m.Setting(e).setName(`Item ${s+1}`).setHeading(),new m.Setting(e).setName("Item name").setDesc("Item names must be unique within a collection.").addText(a=>a.setPlaceholder("Reach 1").setValue(n.name).onChange(async d=>{n.name=d,await this.plugin.saveSettings()})),new m.Setting(e).setName("Item type").setDesc("Choose the inspected or non-inspected type for this item.").addDropdown(a=>{var r;let d=this.getItemTypeSummaries();if(d.length===0){a.addOption("","Add item types first"),a.setValue(""),a.setDisabled(!0);return}d.forEach(c=>{a.addOption(c.id,`${c.name||"(unnamed)"} (${c.kind})`)}),a.setValue(n.typeId||((r=d[0])==null?void 0:r.id)||""),a.onChange(async c=>{n.typeId=c;let I=this.getItemKind(c);I==="point"?(n.startStationItemId=void 0,n.endStationItemId=void 0):I==="linear"&&(n.station=void 0),await this.plugin.saveSettings(),this.display()})});let i=this.getItemKind(n.typeId);if(i==="point"&&new m.Setting(e).setName("Station").setDesc("Station value for this point item.").addText(a=>{var d,r;a.setValue((r=(d=n.station)==null?void 0:d.toString())!=null?r:""),a.inputEl.type="number",a.onChange(async c=>{n.station=c===""?void 0:Number(c),await this.plugin.saveSettings()})}),i==="linear"){let d=t.items.filter(r=>this.getItemKind(r.typeId)==="point").map(r=>({id:r.id,label:`${r.name||"(unnamed)"} ${r.station!==void 0?`@ ${r.station}`:"(no station)"}`}));new m.Setting(e).setName("Start station item").setDesc("Select the point item that defines the start station.").addDropdown(r=>{var c,I;if(d.length===0){r.addOption("","Add a point item first"),r.setValue(""),r.setDisabled(!0);return}d.forEach(l=>r.addOption(l.id,l.label)),r.setValue(n.startStationItemId||((I=(c=d[0])==null?void 0:c.id)!=null?I:"")).onChange(async l=>{n.startStationItemId=l,await this.plugin.saveSettings()})}),new m.Setting(e).setName("End station item").setDesc("Select the point item that defines the end station.").addDropdown(r=>{var c,I;if(d.length===0){r.addOption("","Add a point item first"),r.setValue(""),r.setDisabled(!0);return}d.forEach(l=>r.addOption(l.id,l.label)),r.setValue(n.endStationItemId||((I=(c=d[0])==null?void 0:c.id)!=null?I:"")).onChange(async l=>{n.endStationItemId=l,await this.plugin.saveSettings()})})}new m.Setting(e).setName("Remove item").setDesc("Delete this item from the collection.").addButton(a=>a.setButtonText("Remove").setWarning().onClick(async()=>{t.items=t.items.filter(d=>d.id!==n.id),await this.plugin.saveSettings(),this.display()}))}renderValidation(e){let t=x(this.plugin.settings);if(new m.Setting(e).setName("Validation").setHeading(),t.length===0){e.createEl("p",{text:"All settings are valid."});return}let n=e.createEl("ul");t.forEach(s=>{n.createEl("li",{text:s})})}getItemTypeSummaries(){let e=this.plugin.settings.inspectedItemTypes.map(n=>({id:n.id,name:n.name,kind:n.kind})),t=this.plugin.settings.nonInspectedItemTypes.map(n=>({id:n.id,name:n.name,kind:n.kind}));return[...e,...t]}getItemKind(e){let t=this.getItemTypeSummaries().find(n=>n.id===e);return t==null?void 0:t.kind}};var S=class extends R.Plugin{async onload(){await this.loadSettings(),this.addSettingTab(new y(this.app,this))}async loadSettings(){this.store=new f(this),await this.store.load(),this.settings=this.store.settings}async saveSettings(){await this.store.saveFromSettings(this.settings)}};
